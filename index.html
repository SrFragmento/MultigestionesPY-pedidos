<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Pedidos Mayoristas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* CSS de Dise√±o Llamativo y Profesional */
        :root {
            font-family: 'Inter', sans-serif;
            scroll-behavior: smooth; /* Para el scroll suave del bot√≥n */
        }
        body {
            background-color: #E0F2F1;
            padding: 1rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(10, 20, 40, 0.15);
            overflow: hidden;
        }
        .header {
            background-color: #1E3A8A;
            color: white;
            padding: 3rem 1.5rem 1.5rem;
            text-align: center;
        }
        .brand-title {
            background-color: #BFDBFE;
            color: #1E3A8A;
            padding: 8px 16px;
            border-radius: 12px;
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.95rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .price-badge {
            background-color: #FACC15;
            color: #1F2937;
            font-weight: 900;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 1rem;
            margin-bottom: 6px;
            display: inline-block;
        }
        .logo-placeholder {
            width: 64px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 800;
            color: white;
            border-radius: 15px;
            text-align: center;
            line-height: 1.2;
            padding: 6px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
        }
        .filter-button.active {
            background-color: #FACC15;
            color: #1E3A8A;
            font-weight: 800;
            border: 2px solid #1E3A8A;
        }
        .filter-button {
            transition: all 0.2s;
        }
        .add-to-cart-btn {
            background-color: #10B981 !important;
            box-shadow: 0 4px 8px rgba(16, 185, 129, 0.4) !important;
        }
        /* Ocultar el indicador de carga que ya no se necesita */
        #loading-indicator {
            display: none !important;
        }
        /* Estilos del bot√≥n flotante */
        #scroll-to-top-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: #FACC15; /* Amarillo */
            color: #1E3A8A; /* Azul */
            border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            transition: opacity 0.3s;
            opacity: 0.9;
        }
        #scroll-to-top-btn:hover {
            opacity: 1;
        }
    </style>
</head>
<body>

    <div class="max-w-4xl mx-auto card mt-4 mb-16">

        <!-- Header y Contacto -->
        <header class="header">
            <h1 class="text-4xl font-extrabold mb-1 tracking-wider">SISTEMA DE PEDIDOS MAYORISTAS</h1>
            <p class="text-xl font-light opacity-90 mb-4">MULTIGESTIONES PY</p>
            <p class="text-lg font-bold bg-red-600 text-white p-2 rounded-lg shadow-xl">
                üö® Venta M√≠nima 3 Unidades por Art√≠culo (Abarrotes/Snacks) üö®
            </p>
        </header>

        <main class="p-6 sm:p-10">

            <!-- VISTA DEL CAT√ÅLOGO -->
            <div id="catalog-view">
                
                <div class="flex justify-between items-center mb-8 border-b pb-4 border-gray-200">
                    <h2 class="text-3xl font-bold text-gray-800">Cat√°logo de Productos</h2>
                    <button id="view-cart-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-5 rounded-full shadow-xl transition duration-200 flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                        Ver Carrito (<span id="cart-count">0</span>)
                    </button>
                </div>
                
                <!-- Filtros -->
                <div class="mb-8">
                    <div id="filter-container" class="flex flex-wrap gap-2 sm:gap-4">
                        <!-- Botones de Categor√≠a se insertar√°n aqu√≠ -->
                    </div>
                </div>

                <!-- Lista de Productos -->
                <div id="product-list" class="space-y-4">
                    <!-- Los productos se insertar√°n aqu√≠ por JavaScript -->
                </div>

                <div id="loading-indicator" class="text-center py-12 text-2xl text-indigo-600 font-semibold hidden">Cargando...</div>
            </div>


            <!-- VISTA DEL CARRITO Y FORMULARIO DE CONFIRMACI√ìN -->
            <div id="cart-view" class="hidden">
                <button id="back-to-catalog-btn" class="text-indigo-600 hover:text-indigo-800 font-bold mb-6 flex items-center text-lg">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                    Volver al Cat√°logo
                </button>

                <h2 class="text-4xl font-extrabold text-gray-800 mb-6 border-b pb-2 border-indigo-400">Resumen de Pedido</h2>

                <div id="cart-summary" class="bg-indigo-50 p-5 rounded-xl mb-6 shadow-inner">
                    <div id="cart-item-details" class="cart-item-list space-y-4 mb-4">
                        <!-- Detalles del carrito aqu√≠ -->
                        <p id="empty-cart-message" class="text-gray-500 text-center py-6 text-lg font-medium">üõí El carrito est√° vac√≠o. ¬°A√±ade productos!</p>
                    </div>

                    <div class="flex justify-between items-center pt-4 border-t border-indigo-200">
                        <span class="text-2xl font-bold text-gray-900">TOTAL:</span>
                        <span id="cart-total" class="text-3xl font-extrabold text-red-600">Gs. 0</span>
                    </div>
                    <p id="min-qty-alert" class="text-base text-red-700 mt-3 font-bold hidden">‚ö†Ô∏è **ADVERTENCIA:** Verifica la cantidad m√≠nima (3 unidades) en los art√≠culos mayoristas.</p>
                </div>

                <!-- Formulario de Cliente -->
                <h3 class="text-2xl font-bold text-gray-800 mb-4">Datos del Cliente</h3>
                <form id="client-form" class="space-y-5">
                    <div>
                        <label for="client-name" class="block text-sm font-medium text-gray-700">Nombre o Raz√≥n Social</label>
                        <input type="text" id="client-name" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="client-phone" class="block text-sm font-medium text-gray-700">Tel√©fono / WhatsApp</label>
                        <input type="text" id="client-phone" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="client-address" class="block text-sm font-medium text-gray-700">Direcci√≥n de Entrega</label>
                        <textarea id="client-address" required class="mt-1 block w-full rounded-lg border-gray-300 shadow-sm p-3 border focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>

                    <button type="submit" id="confirm-order-btn" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-extrabold text-xl py-4 rounded-xl shadow-2xl transition duration-200 disabled:opacity-50">
                        <span id="btn-text">CONFIRMAR PEDIDO Y ENVIAR</span>
                    </button>
                    <p id="order-status" class="text-center mt-4 font-bold hidden"></p>
                </form>
            </div>

            <!-- MODAL DE CONFIRMACI√ìN DE ENV√çO -->
            <div id="confirmation-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-80 flex items-center justify-center p-4 z-50">
                <div class="bg-white p-10 rounded-2xl shadow-2xl max-w-md w-full text-center border-t-8 border-emerald-500">
                    <svg class="w-20 h-20 text-emerald-500 mx-auto mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    <h3 class="text-2xl font-extrabold text-gray-900 mb-3">¬°Pedido Enviado!</h3>
                    <p class="text-gray-700 mb-8 font-medium">Se ha abierto una conversaci√≥n de WhatsApp para finalizar el env√≠o de la orden.</p>
                    <button id="close-modal-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 shadow-lg">
                        Cerrar y Volver
                    </button>
                </div>
            </div>

        </main>
    </div>
    
    <!-- BOT√ìN FLOTANTE "SUBIR ARRIBA" -->
    <button id="scroll-to-top-btn" class="hidden">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
    </button>
    
    <script>
        // ESTADO GLOBAL y PRODUCTOS (Definiciones movidas aqu√≠)
        const state = {
            cart: JSON.parse(localStorage.getItem('multigestiones_cart')) || [],
            currentFilter: 'Todos',
        };

        // --- CONFIGURACI√ìN CLAVE ---
        const BUSINESS_PHONE_NUMBER = "595981923378"; 

        // Precios en Guaran√≠es (Gs.)
        const PRODUCTS = [
            // CATEROR√çA DE ALQUILER PARA EVENTOS (M√≠nimo 1)
            { id: 1, name: "Silla Pl√°stica Reforzada", brand: "Servicios", presentation: "Unidad/Evento", price: 1500, category: "Alquiler Eventos", logoColor: "#10B981", logoText: "Silla ü™ë", isRental: true, min: 1 },
            { id: 2, name: "Mesa Redonda (10 personas)", brand: "Servicios", presentation: "Unidad/Evento", price: 15000, category: "Alquiler Eventos", logoColor: "#F59E0B", logoText: "Mesa üçΩÔ∏è", isRental: true, min: 1 },
            { id: 3, name: "Mesa Larga (8 personas)", brand: "Servicios", presentation: "Unidad/Evento", price: 12000, category: "Alquiler Eventos", logoColor: "#F59E0B", logoText: "Mesa üìè", isRental: true, min: 1 },
            { id: 4, name: "Mantel Blanco de Tela", brand: "Servicios", presentation: "Unidad/Evento", price: 7000, category: "Alquiler Eventos", logoColor: "#EAB308", logoText: "Mantel", isRental: true, min: 1 },
            { id: 5, name: "Cubiertos Met√°licos (Set)", brand: "Servicios", presentation: "Set/Evento", price: 800, category: "Alquiler Eventos", logoColor: "#94A3B8", logoText: "Cubiertos", isRental: true, min: 1 },
            { id: 6, name: "Cubre Sillas", brand: "Servicios", presentation: "Unidad/Evento", price: 1000, category: "Alquiler Eventos", logoColor: "#EAB308", logoText: "Cubre", isRental: true, min: 1 },
            { id: 7, name: "Plato Cer√°mica (Principal)", brand: "Servicios", presentation: "Unidad/Evento", price: 900, category: "Alquiler Eventos", logoColor: "#94A3B8", logoText: "Plato", isRental: true, min: 1 },
            { id: 8, name: "Vasos de Cristal", brand: "Servicios", presentation: "Unidad/Evento", price: 700, category: "Alquiler Eventos", logoColor: "#94A3B8", logoText: "Vaso", isRental: true, min: 1 },
            { id: 9, name: "Plato Pl√°stico Reforzado", brand: "Pl√°sticos", presentation: "Unidad/Evento", price: 600, category: "Alquiler Eventos", logoColor: "#0EA5E9", logoText: "Pl√°stico", isRental: true, min: 1 },
            { id: 10, name: "Vasos Pl√°sticos Reutilizables", brand: "Pl√°sticos", presentation: "Unidad/Evento", price: 500, category: "Alquiler Eventos", logoColor: "#0EA5E9", logoText: "Pl√°stico", isRental: true, min: 1 },

            // ABARROTES: L√ÅCTEOS (Mayorista - M√≠nimo 3)
            { id: 11, name: "Leche Entera UAT", brand: "Tr√©bol", presentation: "1 Litro", price: 8500, category: "L√°cteos", logoColor: "#10B981", logoText: "Tr√©bol", isRental: false, min: 3 },
            { id: 12, name: "Yogurt Entero Durazno", brand: "Tr√©bol", presentation: "1 Litro", price: 9200, category: "L√°cteos", logoColor: "#10B981", logoText: "Tr√©bol üçë", isRental: false, min: 3 },
            { id: 13, name: "Manteca Premium", brand: "Tr√©bol", presentation: "250g", price: 12500, category: "L√°cteos", logoColor: "#10B981", logoText: "Tr√©bol", isRental: false, min: 3 },
            { id: 14, name: "Postre Vainilla", brand: "Tr√©bol", presentation: "120g", price: 4000, category: "L√°cteos", logoColor: "#10B981", logoText: "Tr√©bol", isRental: false, min: 3 },
            { id: 15, name: "Leche Descremada UAT", brand: "Lactolanda", presentation: "1 Litro", price: 8800, category: "L√°cteos", logoColor: "#F59E0B", logoText: "Landa", isRental: false, min: 3 },
            { id: 16, name: "Queso Paraguay Fresco", brand: "Lactolanda", presentation: "500g", price: 18500, category: "L√°cteos", logoColor: "#F59E0B", logoText: "Landa üßÄ", isRental: false, min: 3 },
            { id: 17, name: "Dulce de Leche Cl√°sico", brand: "Lactolanda", presentation: "400g", price: 15000, category: "L√°cteos", logoColor: "#F59E0B", logoText: "Landa", isRental: false, min: 3 },
            { id: 18, name: "Leche Cultivada", brand: "Lactolanda", presentation: "1 Litro", price: 9500, category: "L√°cteos", logoColor: "#F59E0B", logoText: "Landa", isRental: false, min: 3 },

            // ABARROTES: BEBIDAS (Mayorista - M√≠nimo 3)
            { id: 19, name: "Coca-Cola Original", brand: "Coca-Cola", presentation: "2 Litros", price: 12000, category: "Bebidas", logoColor: "#EF4444", logoText: "COKE üî¥", isRental: false, min: 3 },
            { id: 20, name: "Coca-Cola Sin Az√∫car", brand: "Coca-Cola", presentation: "1.5 Litros", price: 9500, category: "Bebidas", logoColor: "#EF4444", logoText: "COKE Zero", isRental: false, min: 3 },
            { id: 21, name: "Gaseosa Fanta Naranja", brand: "Coca-Cola", presentation: "2 Litros", price: 10500, category: "Bebidas", logoColor: "#F97316", logoText: "FANTA", isRental: false, min: 3 },
            { id: 22, name: "Jugo (Sabor Naranja)", brand: "Pulp", presentation: "1 Litro", price: 7500, category: "Bebidas", logoColor: "#F97316", logoText: "Pulp üçä", isRental: false, min: 3 },
            { id: 23, name: "Cerveza Pilsen", brand: "Brahma", presentation: "Lata 350ml", price: 6000, category: "Bebidas", logoColor: "#FBBF24", logoText: "Brahma üç∫", isRental: false, min: 3 },
            { id: 24, name: "Cerveza Lager", brand: "Pilsen", presentation: "Botella 1L", price: 11500, category: "Bebidas", logoColor: "#0369A1", logoText: "Pilsen", isRental: false, min: 3 },
            { id: 25, name: "Agua Mineral sin Gas", brand: "Salus", presentation: "1.5 Litros", price: 4500, category: "Bebidas", logoColor: "#4C9CFD", logoText: "Salus", isRental: false, min: 3 },
            { id: 26, name: "Cerveza Lata", brand: "Heineken", presentation: "330ml Lata", price: 7800, category: "Bebidas", logoColor: "#10B981", logoText: "Heineken üç∫", isRental: false, min: 3 },
            { id: 27, name: "Gaseosa Guaran√°", brand: "Guaran√°", presentation: "2 Litros", price: 9000, category: "Bebidas", logoColor: "#3B82F6", logoText: "Guaran√°", isRental: false, min: 3 },
            { id: 28, name: "Agua Saborizada Manzana", brand: "Levit√©", presentation: "600ml", price: 5500, category: "Bebidas", logoColor: "#22C55E", logoText: "Levit√©", isRental: false, min: 3 },
            { id: 29, name: "Vino Tinto Seco", brand: "Santa Helena", presentation: "750ml", price: 35000, category: "Bebidas", logoColor: "#DC2626", logoText: "Vino üç∑", isRental: false, min: 3 },

            // ABARROTES: NO PERECEDEROS (Mayorista - M√≠nimo 3)
            { id: 30, name: "Fideo Spaghetti", brand: "Fortaleza", presentation: "500g", price: 5000, category: "Abarrotes", logoColor: "#EF4444", logoText: "Fuerza", isRental: false, min: 3 },
            { id: 31, name: "Fideo Tallar√≠n", brand: "Adria", presentation: "500g", price: 4800, category: "Abarrotes", logoColor: "#1D4ED8", logoText: "Adria", isRental: false, min: 3 },
            { id: 32, name: "Arroz Grano Largo Tipo 1", brand: "Universo", presentation: "1Kg", price: 8500, category: "Abarrotes", logoColor: "#9333EA", logoText: "Universo", isRental: false, min: 3 },
            { id: 33, name: "Harina de Trigo 000", brand: "Hijo de Tigre", presentation: "1Kg", price: 6500, category: "Abarrotes", logoColor: "#334155", logoText: "Tigre", isRental: false, min: 3 },
            { id: 34, name: "Az√∫car Rubia", brand: "Azucarera Nacional", presentation: "1Kg", price: 5200, category: "Abarrotes", logoColor: "#FB7185", logoText: "Az√∫car", isRental: false, min: 3 },
            { id: 35, name: "Sal Fina Yodada", brand: "Marina", presentation: "500g", price: 2500, category: "Abarrotes", logoColor: "#94A3B8", logoText: "Marina", isRental: false, min: 3 },
            { id: 36, name: "Aceite Girasol", brand: "Cocinero", presentation: "900ml", price: 15000, category: "Abarrotes", logoColor: "#FACC15", logoText: "Cocinero", isRental: false, min: 3 },
            { id: 37, name: "Yerba Mate Cl√°sica", brand: "Kurup√≠", presentation: "500g", price: 15500, category: "Abarrotes", logoColor: "#22C55E", logoText: "Kurup√≠", isRental: false, min: 3 },
            { id: 38, name: "Yerba Mate Compuesta", brand: "Selecta", presentation: "1Kg", price: 28000, category: "Abarrotes", logoColor: "#059669", logoText: "Selecta", isRental: false, min: 3 },
            { id: 39, name: "Poroto Negro", brand: "El Molino", presentation: "1Kg", price: 9000, category: "Abarrotes", logoColor: "#9333EA", logoText: "Molino", isRental: false, min: 3 },
            { id: 40, name: "Lentejas", brand: "El Molino", presentation: "500g", price: 6500, category: "Abarrotes", logoColor: "#9333EA", logoText: "Molino", isRental: false, min: 3 },
            { id: 41, name: "Mayonesa Cl√°sica", brand: "Hellmann's", presentation: "500g Pote", price: 13000, category: "Abarrotes", logoColor: "#FACC15", logoText: "Hellman's", isRental: false, min: 3 },
            { id: 42, name: "Ketchup", brand: "Heinz", presentation: "397g", price: 11500, category: "Abarrotes", logoColor: "#EF4444", logoText: "Heinz", isRental: false, min: 3 },
            { id: 43, name: "Caf√© Instant√°neo", brand: "Nescaf√©", presentation: "100g", price: 18000, category: "Abarrotes", logoColor: "#994D1B", logoText: "Caf√©", isRental: false, min: 3 },
            { id: 44, name: "Mermelada Frutilla", brand: "Arcor", presentation: "400g", price: 9800, category: "Abarrotes", logoColor: "#DC2626", logoText: "Arcor üçì", isRental: false, min: 3 },
            { id: 45, name: "Caldo Cubitos Carne", brand: "Maggi", presentation: "Caja x 12", price: 7000, category: "Abarrotes", logoColor: "#F97316", logoText: "Maggi", isRental: false, min: 3 },
            { id: 46, name: "At√∫n en Aceite", brand: "La Sirena", presentation: "170g Lata", price: 11000, category: "Abarrotes", logoColor: "#0891B2", logoText: "Sirena üêü", isRental: false, min: 3 },
            { id: 47, name: "Arvejas en Lata", brand: "Arcor", presentation: "300g Lata", price: 4500, category: "Abarrotes", logoColor: "#DC2626", logoText: "Arcor", isRental: false, min: 3 },
            { id: 48, name: "Tomate Pelado Cubeteado", brand: "Mutti", presentation: "400g Lata", price: 8000, category: "Abarrotes", logoColor: "#B91C1C", logoText: "Mutti", isRental: false, min: 3 },
            { id: 49, name: "Choclo en Grano", brand: "Arcor", presentation: "300g Lata", price: 5500, category: "Abarrotes", logoColor: "#DC2626", logoText: "Arcor üåΩ", isRental: false, min: 3 },
            { id: 50, name: "Salsa de Tomate Lista", brand: "Mutti", presentation: "520g Botella", price: 9000, category: "Abarrotes", logoColor: "#B91C1C", logoText: "Mutti", isRental: false, min: 3 },

            // ABARROTES: SNACKS (Mayorista - M√≠nimo 3)
            { id: 51, name: "Papas Fritas Onduladas", brand: "Karup√°", presentation: "60g", price: 3500, category: "Snacks", logoColor: "#7E22CE", logoText: "Karup√° ü•î", isRental: false, min: 3 },
            { id: 52, name: "Chizitos Queso", brand: "Do√±a", presentation: "80g", price: 4200, category: "Snacks", logoColor: "#CA8A04", logoText: "Do√±a üßÄ", isRental: false, min: 3 },
            { id: 53, name: "Galleta Chocolate Rellena", brand: "Oreo", presentation: "Pack", price: 6500, category: "Snacks", logoColor: "#1E3A8A", logoText: "Oreo", isRental: false, min: 3 },
            { id: 54, name: "Alfajor Triple Chocolate", brand: "Jorgito", presentation: "Unidad", price: 4500, category: "Snacks", logoColor: "#0F766E", logoText: "Jorgito", isRental: false, min: 3 },
            { id: 55, name: "Man√≠ Tostado Salado", brand: "Manisa", presentation: "100g", price: 4000, category: "Snacks", logoColor: "#84CC16", logoText: "Manisa", isRental: false, min: 3 },
            { id: 56, name: "Galleta Vainilla", brand: "Arcor", presentation: "Pack x 6", price: 8000, category: "Snacks", logoColor: "#DC2626", logoText: "Arcor", isRental: false, min: 3 },
            { id: 57, name: "Papas Fritas Lisas", brand: "Pringles", presentation: "Lata 120g", price: 15000, category: "Snacks", logoColor: "#EF4444", logoText: "Pringles", isRental: false, min: 3 },
            { id: 58, name: "Caramelos Surtidos", brand: "Arcor", presentation: "Bolsa 500g", price: 12000, category: "Snacks", logoColor: "#DC2626", logoText: "Arcor", isRental: false, min: 3 },
            
            // ABARROTES: CONGELADOS (Mayorista - M√≠nimo 3)
            { id: 59, name: "Papas Fritas Prefritas", brand: "McCain", presentation: "1Kg Bolsa", price: 18000, category: "Congelados", logoColor: "#EF4444", logoText: "McCain üçü", isRental: false, min: 3 },
            { id: 60, name: "Nuggets de Pollo", brand: "Knorr", presentation: "500g Caja", price: 25000, category: "Congelados", logoColor: "#F97316", logoText: "Knorr", isRental: false, min: 3 },
            { id: 61, name: "Pizza Muzzarella", brand: "Sadia", presentation: "Unidad", price: 28000, category: "Congelados", logoColor: "#4F46E5", logoText: "Sadia", isRental: false, min: 3 },
            { id: 62, name: "Vegetales Mixtos", brand: "Quickfood", presentation: "500g Bolsa", price: 11000, category: "Congelados", logoColor: "#0EA5E9", logoText: "Quick", isRental: false, min: 3 },
            { id: 63, name: "Hielo en Cubos", brand: "G√©nesis", presentation: "2Kg Bolsa", price: 4500, category: "Congelados", logoColor: "#3B82F6", logoText: "G√©nesis üßä", isRental: false, min: 3 },
            { id: 64, name: "Hamburguesa Carne", brand: "Sadia", presentation: "Caja x 4", price: 16000, category: "Congelados", logoColor: "#4F46E5", logoText: "Sadia", isRental: false, min: 3 },

            // ABARROTES: LIMPIEZA (Mayorista - M√≠nimo 3)
            { id: 65, name: "Detergente Lavaplatos Lim√≥n", brand: "Magistral", presentation: "500ml", price: 9500, category: "Limpieza", logoColor: "#06B6D4", logoText: "Magis üíß", isRental: false, min: 3 },
            { id: 66, name: "Lavandina Desinfectante", brand: "Sapolio", presentation: "1 Litro", price: 6000, category: "Limpieza", logoColor: "#4F46E5", logoText: "Sapolio ‚ö°", isRental: false, min: 3 },
            { id: 67, name: "Jab√≥n en Polvo", brand: "OMO", presentation: "1Kg", price: 22000, category: "Limpieza", logoColor: "#0EA5E9", logoText: "OMO", isRental: false, min: 3 },
            { id: 68, name: "Suavizante Concentrado", brand: "Vanish", presentation: "900ml", price: 15800, category: "Limpieza", logoColor: "#C026D3", logoText: "Vanish", isRental: false, min: 3 },
            { id: 69, name: "Limpiador Vidrios", brand: "Mr. M√∫sculo", presentation: "500ml", price: 8500, category: "Limpieza", logoColor: "#22C55E", logoText: "M√∫sculo", isRental: false, min: 3 },
            { id: 70, name: "Papel Higi√©nico Doble Hoja", brand: "Nevada", presentation: "Pack x 4", price: 14500, category: "Limpieza", logoColor: "#FACC15", logoText: "Nevada", isRental: false, min: 3 },
            { id: 71, name: "Jab√≥n de Tocador", brand: "Dove", presentation: "Unidad", price: 4000, category: "Limpieza", logoColor: "#0EA5E9", logoText: "Dove", isRental: false, min: 3 },
            { id: 72, name: "Bolsa de Basura Reforzada", brand: "Rey", presentation: "Pack x 10", price: 10000, category: "Limpieza", logoColor: "#1F2937", logoText: "Rey üëë", isRental: false, min: 3 },
            { id: 73, name: "Limpiador Desinfectante", brand: "Lysoform", presentation: "500ml", price: 9800, category: "Limpieza", logoColor: "#4F46E5", logoText: "Lysoform", isRental: false, min: 3 },
        ];

        const allCategories = PRODUCTS.map(p => p.category);
        const categories = [...new Set(allCategories)];
        categories.unshift('Todos'); 
        
        // Elementos definidos globalmente pero asignados en init
        let ELEMENTS; 

        // --- FUNCIONES DE CARRITO (Iguales) ---
        function saveCart() {
            localStorage.setItem('multigestiones_cart', JSON.stringify(state.cart));
            updateCartUI();
            checkOrderValidity();
        }

        function updateCartQuantity(productId, newQuantity) {
            const itemIndex = state.cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                if (newQuantity <= 0) {
                    state.cart.splice(itemIndex, 1);
                } else {
                    state.cart[itemIndex].quantity = newQuantity;
                }
            }
            saveCart();
            renderProducts(state.currentFilter);
        }

        function addToCart(productId) {
            const product = PRODUCTS.find(p => p.id === productId);
            if (!product) return;

            const existingItemIndex = state.cart.findIndex(item => item.id === productId);
            const minQty = product.isRental ? 1 : 3;

            if (existingItemIndex > -1) {
                state.cart[existingItemIndex].quantity += minQty;
            } else {
                state.cart.push({
                    id: productId,
                    name: product.name,
                    brand: product.brand,
                    price: product.price,
                    presentation: product.presentation,
                    isRental: product.isRental,
                    category: product.category,
                    quantity: minQty,
                });
            }

            saveCart();
        }

        function updateCartUI() {
            if (!ELEMENTS || !ELEMENTS.cartCount) return; 
            ELEMENTS.cartCount.textContent = state.cart.reduce((total, item) => total + item.quantity, 0);
            renderCartSummary();
        }

        function renderCartSummary() {
            if (!ELEMENTS || !ELEMENTS.cartItemDetails) return;
            ELEMENTS.cartItemDetails.innerHTML = '';
            let total = 0;
            const itemsInCart = state.cart.length;

            if (itemsInCart === 0) {
                ELEMENTS.emptyCartMessage.classList.remove('hidden');
                ELEMENTS.confirmOrderBtn.disabled = true;
                ELEMENTS.cartTotal.textContent = 'Gs. 0';
                return;
            } else {
                ELEMENTS.emptyCartMessage.classList.add('hidden');
            }

            state.cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemDiv = document.createElement('div');
                itemDiv.className = 'flex flex-col sm:flex-row justify-between items-start sm:items-center p-3 bg-white rounded-lg border';
                
                const infoSection = document.createElement('div');
                infoSection.className = 'flex-grow mb-2 sm:mb-0';
                infoSection.innerHTML = `
                    <p class="font-semibold text-gray-800">${item.name}</p>
                    <p class="text-xs text-gray-500 font-medium">(${item.brand}) ${item.presentation}</p>
                    <p class="text-sm font-medium text-blue-600">Precio c/u: Gs. ${item.price.toLocaleString('es-ES')}</p>
                `;

                const controlsSection = document.createElement('div');
                controlsSection.className = 'flex items-center space-x-4 flex-shrink-0';
                
                const qtyControl = document.createElement('div');
                qtyControl.className = 'qty-control flex items-center border rounded-lg';
                qtyControl.innerHTML = `
                    <button type="button" data-action="decrement" data-id="${item.id}" class="rounded-l-lg hover:bg-gray-300">-</button>
                    <input type="text" value="${item.quantity}" readonly class="text-center bg-transparent focus:outline-none">
                    <button type="button" data-action="increment" data-id="${item.id}" class="rounded-r-lg hover:bg-gray-300">+</button>
                `;
                
                const totalSpan = document.createElement('span');
                totalSpan.className = 'font-bold text-lg text-emerald-500 w-24 text-right flex-shrink-0';
                totalSpan.textContent = `Gs. ${itemTotal.toLocaleString('es-ES')}`;

                controlsSection.appendChild(qtyControl);
                controlsSection.appendChild(totalSpan);

                itemDiv.appendChild(infoSection);
                itemDiv.appendChild(controlsSection);
                
                ELEMENTS.cartItemDetails.appendChild(itemDiv);
            });

            ELEMENTS.cartTotal.textContent = `Gs. ${total.toLocaleString('es-ES')}`;
            
            // Re-bind listeners for new buttons
            document.querySelectorAll('.qty-control button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.dataset.id);
                    const action = e.target.dataset.action;
                    const item = state.cart.find(i => i.id === productId);
                    if (!item) return;

                    let newQty = item.quantity;

                    if (action === 'increment') {
                        newQty += 1;
                    } else if (action === 'decrement') {
                        newQty -= 1;
                        if (newQty < 0) newQty = 0;
                    }

                    updateCartQuantity(productId, newQty);
                });
            });

            checkOrderValidity();
        }

        function checkOrderValidity() {
            if (!ELEMENTS || !ELEMENTS.confirmOrderBtn) return;
            let isValid = state.cart.length > 0;
            let needsMinQtyAlert = false;
            
            state.cart.forEach(item => {
                if (!item.isRental && item.quantity < 3) {
                    isValid = false;
                    needsMinQtyAlert = true;
                }
            });

            if (needsMinQtyAlert) {
                ELEMENTS.minQtyAlert.classList.remove('hidden');
                ELEMENTS.confirmOrderBtn.disabled = true; 
            } else {
                ELEMENTS.minQtyAlert.classList.add('hidden');
                ELEMENTS.confirmOrderBtn.disabled = !isValid || !ELEMENTS.clientForm.checkValidity();
            }
        }

        // --- L√ìGICA DE RENDERIZADO (Igual) ---
        function createProductItem(product) {
            const item = document.createElement('div');
            const isRental = product.isRental;
            const minQty = product.min;
            const itemInCart = state.cart.find(i => i.id === product.id);

            item.className = 'product-item p-4 sm:p-5 flex flex-col sm:flex-row items-center justify-between bg-white rounded-xl border-4 ' + (isRental ? 'border-emerald-500' : 'border-gray-100 shadow-md');
            
            const leftSection = document.createElement('div');
            leftSection.className = 'flex items-start space-x-4 sm:space-x-6 w-full sm:w-2/3 mb-3 sm:mb-0';

            const logo = document.createElement('div');
            logo.className = 'logo-placeholder shadow-lg flex-shrink-0';
            logo.style.backgroundColor = product.logoColor;
            logo.textContent = product.logoText;
            
            const info = document.createElement('div');
            info.innerHTML = `
                <p class="text-lg font-extrabold text-gray-900">${product.name}</p>
                <p class="text-sm text-gray-500 font-medium mt-0.5">
                    ${product.presentation} | <span class="font-bold text-xs ${isRental ? 'text-red-600' : 'text-blue-600'}">
                        ${isRental ? 'Alquiler/Evento' : `Mayorista (M√≠nimo ${minQty})`}
                    </span>
                    ${itemInCart ? `<span class="text-sm font-extrabold text-emerald-500 ml-2">(En carrito: ${itemInCart.quantity})</span>` : ''}
                </p>
            `;

            leftSection.appendChild(logo);
            leftSection.appendChild(info);

            const rightSection = document.createElement('div');
            rightSection.className = 'flex flex-col items-end space-y-2 w-full sm:w-1/3 justify-end';

            const priceSpan = `<span class="price-badge ${isRental ? 'bg-red-600 text-white' : 'bg-amber-400 text-gray-900'} shadow-md">Gs. ${product.price.toLocaleString('es-ES')}</span>`;
            rightSection.innerHTML += priceSpan;

            const addButton = document.createElement('button');
            addButton.className = 'add-to-cart-btn w-32 bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 rounded-lg text-sm transition duration-150 shadow-lg';
            addButton.textContent = `Agregar (${minQty} U.)`;
            addButton.dataset.id = product.id;
            addButton.addEventListener('click', (e) => {
                addToCart(parseInt(e.target.dataset.id));
            });
            
            rightSection.appendChild(addButton);

            item.appendChild(leftSection);
            item.appendChild(rightSection);
            
            return item;
        }

        function renderProducts(category) {
            if (!ELEMENTS || !ELEMENTS.productList) return;
            ELEMENTS.productList.innerHTML = '';
            
            const filteredProducts = PRODUCTS.filter(product => 
                category === 'Todos' || product.category === category
            ).sort((a, b) => {
                if (a.category !== b.category) return a.category.localeCompare(b.category);
                if (a.brand !== b.brand) return a.brand.localeCompare(b.brand);
                return a.name.localeCompare(b.name);
            });

            if (filteredProducts.length === 0) {
                ELEMENTS.productList.innerHTML = `<p class="text-center text-gray-500 py-12 text-lg">No se encontraron productos en la categor√≠a "${category}".</p>`;
                return;
            }

            let currentCategoryTitle = '';
            let currentBrandTitle = '';
            
            filteredProducts.forEach(product => {
                if (category === 'Todos' && product.category !== currentCategoryTitle) {
                    currentCategoryTitle = product.category;
                    const catTitle = document.createElement('h2');
                    catTitle.className = 'text-3xl font-extrabold text-blue-900 mt-10 mb-5 pb-2 border-b-4 border-amber-400';
                    catTitle.textContent = product.category.toUpperCase();
                    ELEMENTS.productList.appendChild(catTitle);
                    currentBrandTitle = ''; 
                }

                if (product.brand !== currentBrandTitle) {
                    currentBrandTitle = product.brand;
                    const brandTitle = document.createElement('div');
                    brandTitle.className = 'brand-title';
                    brandTitle.textContent = `MARCA: ${product.brand}`;
                    ELEMENTS.productList.appendChild(brandTitle);
                }

                ELEMENTS.productList.appendChild(createProductItem(product));
            });

            document.querySelectorAll('.filter-button').forEach(btn => {
                if (btn.textContent.trim() === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function setupFilters() {
            if (!ELEMENTS || !ELEMENTS.filterContainer) return;
            ELEMENTS.filterContainer.innerHTML = '';
            categories.forEach(cat => {
                const button = document.createElement('button');
                button.className = 'filter-button bg-gray-200 text-gray-700 hover:bg-gray-300 py-2 px-4 rounded-full text-sm shadow-md transition duration-200';
                button.textContent = cat;
                button.addEventListener('click', () => {
                    state.currentFilter = cat;
                    renderProducts(cat);
                });
                ELEMENTS.filterContainer.appendChild(button);
            });
            state.currentFilter = 'Todos';
            renderProducts(state.currentFilter);
        }

        // --- FUNCI√ìN DE ENV√çO DE ORDEN A WHATSAPP ---
        function generateWhatsAppMessage(clientName, clientPhone, clientAddress, total) {
            let message = `*‚úÖ NUEVO PEDIDO MAYORISTA - MULTIGESTIONES PY ‚úÖ*\n\n`;
            message += `*CLIENTE:* ${clientName}\n`;
            message += `*TEL√âFONO:* ${clientPhone}\n`;
            message += `*DIRECCI√ìN:* ${clientAddress}\n\n`;
            message += `--- DETALLE DE LA ORDEN ---\n`;

            state.cart.forEach(item => {
                const type = item.isRental ? 'Alquiler' : 'Mayorista';
                const subtotal = item.price * item.quantity;
                message += `*‚Ä¢ ${item.name} (${item.brand})*\n`;
                message += `  - Cantidad: ${item.quantity} U.\n`;
                message += `  - Tipo: ${type}\n`;
                message += `  - Subtotal: Gs. ${subtotal.toLocaleString('es-ES')}\n`;
            });

            message += `\n*TOTAL FINAL A PAGAR:* Gs. ${total.toLocaleString('es-ES')}\n`;
            message += `\n(Enviado desde el cat√°logo web)`;

            return encodeURIComponent(message);
        }

        async function submitOrder(e) {
            e.preventDefault();

            if (state.cart.length === 0) return;
            checkOrderValidity();

            ELEMENTS.confirmOrderBtn.disabled = true;
            ELEMENTS.btnText.textContent = "Generando Enlace...";

            const total = state.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const clientName = ELEMENTS.clientForm['client-name'].value;
            const clientPhone = ELEMENTS.clientForm['client-phone'].value;
            const clientAddress = ELEMENTS.clientForm['client-address'].value;

            const whatsappMessage = generateWhatsAppMessage(clientName, clientPhone, clientAddress, total);
            
            const whatsappUrl = `https://api.whatsapp.com/send?phone=${BUSINESS_PHONE_NUMBER}&text=${whatsappMessage}`;
            
            window.open(whatsappUrl, '_blank');

            ELEMENTS.confirmationModal.classList.remove('hidden');

            state.cart = [];
            localStorage.removeItem('multigestiones_cart');
        }

        // --- MANEJO DE VISTAS Y EVENTOS (Igual) ---

        function setupEventListeners() {
            if (!ELEMENTS || !ELEMENTS.viewCartBtn) return; 

            ELEMENTS.viewCartBtn.addEventListener('click', () => {
                ELEMENTS.catalogView.classList.add('hidden');
                ELEMENTS.cartView.classList.remove('hidden');
                renderCartSummary();
            });

            ELEMENTS.backToCatalogBtn.addEventListener('click', () => {
                ELEMENTS.cartView.classList.add('hidden');
                ELEMENTS.catalogView.classList.remove('hidden');
                renderProducts(state.currentFilter);
            });

            ELEMENTS.clientForm.addEventListener('submit', submitOrder);
            
            ELEMENTS.clientForm.addEventListener('input', checkOrderValidity);

            ELEMENTS.closeModalBtn.addEventListener('click', () => {
                ELEMENTS.confirmationModal.classList.add('hidden');
                ELEMENTS.cartView.classList.add('hidden');
                ELEMENTS.catalogView.classList.remove('hidden');
                ELEMENTS.btnText.textContent = "CONFIRMAR PEDIDO Y ENVIAR";
                updateCartUI();
                renderProducts('Todos');
            });
            
            // L√≥gica para el bot√≥n de "Subir Arriba"
            ELEMENTS.scrollToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            window.addEventListener('scroll', () => {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    ELEMENTS.scrollToTopBtn.classList.remove('hidden');
                } else {
                    ELEMENTS.scrollToTopBtn.classList.add('hidden');
                }
            });
        }

        // --- INICIALIZACI√ìN PRINCIPAL (Al final del body) ---
        function initApp() {
            // Se definen ELEMENTS aqu√≠, despu√©s de que todo el HTML se ha cargado.
            ELEMENTS = {
                productList: document.getElementById('product-list'),
                filterContainer: document.getElementById('filter-container'),
                cartCount: document.getElementById('cart-count'),
                cartView: document.getElementById('cart-view'),
                catalogView: document.getElementById('catalog-view'),
                viewCartBtn: document.getElementById('view-cart-btn'),
                backToCatalogBtn: document.getElementById('back-to-catalog-btn'),
                cartItemDetails: document.getElementById('cart-item-details'),
                cartTotal: document.getElementById('cart-total'),
                emptyCartMessage: document.getElementById('empty-cart-message'),
                clientForm: document.getElementById('client-form'),
                confirmOrderBtn: document.getElementById('confirm-order-btn'),
                orderStatus: document.getElementById('order-status'),
                confirmationModal: document.getElementById('confirmation-modal'),
                closeModalBtn: document.getElementById('close-modal-btn'),
                minQtyAlert: document.getElementById('min-qty-alert'),
                loadingIndicator: document.getElementById('loading-indicator'),
                btnText: document.getElementById('btn-text'),
                scrollToTopBtn: document.getElementById('scroll-to-top-btn'), 
            };

            // Ejecuci√≥n de la aplicaci√≥n
            setupFilters();
            setupEventListeners();
            updateCartUI();
        }

        // Asegurarse de que la aplicaci√≥n se inicie.
        // Como el script est√° al final del <body>, el DOM ya deber√≠a estar listo.
        initApp();
    </script>
</body>
</html>

